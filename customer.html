<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ | ‡∏™‡∏±‡πà‡∏á‡∏à‡∏≠‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <div class="topbar">
    <div class="inner">
      <div class="brand">üçú <span>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ | ‡∏™‡∏±‡πà‡∏á‡∏à‡∏≠‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£</span></div>
      <div class="badge">Pickup Only</div>
    </div>
  </div>

  <div class="container">
    <div class="grid">
      <section class="card">
        <h3>‡πÄ‡∏°‡∏ô‡∏π‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3>
        <p class="sub">‡∏Å‡∏î ‚Äú‡πÄ‡∏û‡∏¥‡πà‡∏°‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏™‡πà‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</p>
        <div id="menuList" class="list"></div>
      </section>

      <section class="card">
        <h3>‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</h3>
        <p class="sub">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏±‡∏ö ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏™‡∏±‡πà‡∏á</p>
        <div id="cartList" class="list"></div>

        <div class="kpi">
          <span class="muted">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô</span>
          <strong id="totalTxt">‡∏ø0</strong>
        </div>

        <div class="row" style="margin-top:10px">
          <div class="grow">
            <input id="pickup" type="datetime-local">
          </div>
        </div>

        <div class="row">
          <div class="grow">
            <textarea id="note" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ ‡πÄ‡∏ä‡πà‡∏ô ‡πÑ‡∏°‡πà‡πÄ‡∏ú‡πá‡∏î / ‡πÑ‡∏°‡πà‡∏ú‡∏±‡∏Å"></textarea>
          </div>
        </div>

        <button class="btn primary" id="orderBtn">‡∏™‡∏±‡πà‡∏á‡∏à‡∏≠‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£</button>
        <div id="toast" class="toast" style="display:none"></div>
      </section>
    </div>

    <section class="card" style="margin-top:14px">
      <h3>‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
      <p class="sub">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ</p>
      <div id="lastOrderBox" class="list"></div>
    </section>
  </div>

  <script src="data.js"></script>
  <script>
    let cart = []; // [{id,name,price,qty}]

    const el = (id)=>document.getElementById(id);

    function showToast(msg, type="ok"){
      const t = el("toast");
      t.style.display = "block";
      t.className = "toast" + (type==="warn" ? " warn" : type==="danger" ? " danger" : "");
      t.textContent = msg;
      setTimeout(()=>{ t.style.display="none"; }, 2500);
    }

    function renderMenu(){
      const box = el("menuList");
      box.innerHTML = "";
      MENU.forEach(m=>{
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
          <div>
            <div class="title">${m.name}</div>
            <div class="meta">${money(m.price)}</div>
          </div>
          <div class="actions">
            <button class="ok" data-add="${m.id}">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
          </div>
        `;
        box.appendChild(div);
      });

      box.querySelectorAll("button[data-add]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = Number(btn.dataset.add);
          const m = MENU.find(x=>x.id===id);
          const found = cart.find(x=>x.id===id);
          if(found) found.qty++;
          else cart.push({id:m.id, name:m.name, price:m.price, qty:1});
          renderCart();
        });
      });
    }

    function renderCart(){
      const box = el("cartList");
      box.innerHTML = "";
      let total = 0;

      if(cart.length===0){
        box.innerHTML = `<div class="muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</div>`;
        el("totalTxt").textContent = "‡∏ø0";
        return;
      }

      cart.forEach((c, idx)=>{
        total += c.price * c.qty;
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
          <div>
            <div class="title">${c.name}</div>
            <div class="meta">${money(c.price)} √ó ${c.qty} = <b>${money(c.price*c.qty)}</b></div>
          </div>
          <div class="actions">
            <button data-act="dec" data-idx="${idx}">-</button>
            <button class="ok" data-act="inc" data-idx="${idx}">+</button>
            <button class="danger" data-act="del" data-idx="${idx}">‡∏•‡∏ö</button>
          </div>
        `;
        box.appendChild(div);
      });

      el("totalTxt").textContent = money(total);

      box.querySelectorAll("button[data-act]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const idx = Number(btn.dataset.idx);
          const act = btn.dataset.act;
          if(act==="inc") cart[idx].qty++;
          if(act==="dec") cart[idx].qty = Math.max(1, cart[idx].qty-1);
          if(act==="del") cart.splice(idx,1);
          renderCart();
        });
      });
    }

    function renderLastOrder(){
      const box = el("lastOrderBox");
      const orders = getOrders().sort((a,b)=>b.id-a.id);
      const last = orders[0];

      box.innerHTML = "";
      if(!last){
        box.innerHTML = `<div class="muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</div>`;
        return;
      }

      const itemsTxt = last.items.map(i=>`${i.name}√ó${i.qty}`).join(", ");
      const div = document.createElement("div");
      div.className = "item";
      div.innerHTML = `
        <div>
          <div class="title">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå #${last.id}</div>
          <div class="meta">‡∏£‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤: ${formatDT(last.pickup)} ‚Ä¢ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <b>${last.status}</b></div>
          <div class="meta">${itemsTxt}</div>
        </div>
        <div class="actions">
          <span class="pill">${money(last.total)}</span>
        </div>
      `;
      box.appendChild(div);
    }

    function createOrder(){
      if(cart.length===0) return showToast("‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á", "warn");
      const pickup = el("pickup").value;
      if(!pickup) return showToast("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏´‡∏≤‡∏£", "warn");

      let total = 0;
      cart.forEach(c=> total += c.price*c.qty);

      const orders = getOrders();
      const order = {
        id: Date.now(),
        items: cart.map(c=>({id:c.id, name:c.name, price:c.price, qty:c.qty})),
        pickup,
        note: el("note").value || "",
        status: STATUS.PENDING,
        total,
        createdAt: new Date().toISOString()
      };
      orders.push(order);
      saveOrders(orders);

      cart = [];
      el("note").value = "";
      renderCart();
      renderLastOrder();
      showToast("‡∏™‡∏±‡πà‡∏á‡∏à‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ ‡πÑ‡∏õ‡∏î‡∏π‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢");
    }

    document.addEventListener("DOMContentLoaded", ()=>{
      renderMenu();
      renderCart();
      renderLastOrder();
      el("orderBtn").addEventListener("click", createOrder);
    });
  </script>
</body>
</html>
