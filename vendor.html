<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£ | ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <div class="topbar">
    <div class="inner">
      <div class="brand">üßë‚Äçüç≥ <span>‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£ | ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</span></div>
      <div class="badge">Order Inbox</div>
    </div>
  </div>

  <div class="container">
    <section class="card">
      <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h3>
      <p class="sub">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏´‡πâ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏´‡πá‡∏ô‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå (‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô)</p>

      <div class="row">
        <button class="btn small ghost" id="refreshBtn">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
        <button class="btn small danger" id="clearCanceledBtn">‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      </div>

      <div id="ordersList" class="list" style="margin-top:10px"></div>
    </section>
  </div>

  <script src="data.js"></script>
  <script>
    const el = (id)=>document.getElementById(id);

    function render(){
      const box = el("ordersList");
      const orders = getOrders().sort((a,b)=>b.id-a.id);

      box.innerHTML = "";
      if(orders.length===0){
        box.innerHTML = `<div class="muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</div>`;
        return;
      }

      orders.forEach(o=>{
        const itemsTxt = o.items.map(i=>`${i.name}√ó${i.qty}`).join(", ");
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
          <div>
            <div class="title">‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå #${o.id}</div>
            <div class="meta">‡∏£‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤: ${formatDT(o.pickup)} ‚Ä¢ ‡∏¢‡∏≠‡∏î: <b>${money(o.total)}</b></div>
            <div class="meta">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <b>${o.status}</b></div>
            <div class="meta">${itemsTxt}</div>
            ${o.note ? `<div class="meta">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${o.note}</div>` : ``}
          </div>
          <div class="actions">
            <button class="warn" data-set="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥" data-id="${o.id}">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥</button>
            <button class="ok" data-set="‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö" data-id="${o.id}">‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö</button>
            <button class="ok" data-set="‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß" data-id="${o.id}">‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß</button>
            <button class="danger" data-set="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å" data-id="${o.id}">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
          </div>
        `;
        box.appendChild(div);
      });

      box.querySelectorAll("button[data-set]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = Number(btn.dataset.id);
          const st = btn.dataset.set;
          updateStatus(id, st);
        });
      });
    }

    function updateStatus(id, status){
      const orders = getOrders();
      const o = orders.find(x=>Number(x.id)===Number(id));
      if(!o) return;

      // ‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á: ‡∏ñ‡πâ‡∏≤‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ (‡∏Å‡∏±‡∏ô‡∏°‡∏±‡πà‡∏ß)
      if(o.status === STATUS.CANCEL && status !== STATUS.CANCEL) return;

      o.status = status;
      saveOrders(orders);
      render();
    }

    function hideCanceled(){
      const orders = getOrders().filter(o=>o.status !== STATUS.CANCEL);
      saveOrders(orders);
      render();
    }

    document.addEventListener("DOMContentLoaded", ()=>{
      el("refreshBtn").addEventListener("click", render);
      el("clearCanceledBtn").addEventListener("click", hideCanceled);
      render();
      // auto refresh ‡∏ó‡∏∏‡∏Å 3 ‡∏ß‡∏¥ (‡∏Å‡∏±‡∏ô‡∏•‡∏∑‡∏°‡∏Å‡∏î‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä)
      setInterval(render, 3000);
    });
  </script>
</body>
</html>
